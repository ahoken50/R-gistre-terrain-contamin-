# üìã Proposition pour l'Onglet "D√©contamin√©s"

## üéØ Objectif

L'onglet "D√©contamin√©s" doit servir d'**archive permanente** des terrains qui ont √©t√© assainis et ne figurent plus dans le registre gouvernemental actif.

---

## üí° Proposition de Fonctionnalit√©s

### 1. **Identification Automatique des Terrains D√©contamin√©s**

#### Crit√®res de D√©tection :
```javascript
Un terrain est consid√©r√© comme d√©contamin√© SI :
‚úÖ Il a une date d'avis de d√©contamination (champ "avis_decontamination")
OU
‚úÖ Il √©tait dans les donn√©es municipales mais n'est plus dans le registre gouvernemental
   ET a un commentaire indiquant "d√©contamin√©"
```

#### Donn√©es √† Afficher :
```
üìç Adresse compl√®te
üìù Num√©ro de lot cadastral
üî¢ Ancienne r√©f√©rence MENVIQ (pour tra√ßabilit√©)
üìÖ Date de l'avis de d√©contamination
üìÑ Num√©ro d'inscription au bureau de la publicit√© des droits
üí¨ Commentaires/Notes
üìä Historique (optionnel)
```

---

### 2. **Interface Propos√©e**

#### A. Message Informatif en Haut
```markdown
‚úÖ Archive des Terrains D√©contamin√©s

Ces terrains ont fait l'objet d'une d√©contamination et ne figurent plus 
dans le registre actif du gouvernement. Cette archive est conserv√©e √† 
des fins de tra√ßabilit√© et d'historique.

üìä Total : [X] terrains d√©contamin√©s archiv√©s
üìÖ Derni√®re mise √† jour : [Date]
```

#### B. Filtres Sp√©cifiques
```
- Filtrer par adresse
- Filtrer par p√©riode de d√©contamination (ann√©e)
- Filtrer par lot cadastral
- Recherche globale
```

#### C. Tableau des Donn√©es
```
| Adresse | Lot | Ancienne R√©f. | Date D√©contamination | Bureau Publicit√© | Statut | Commentaires |
```

#### D. Badge de Statut
Chaque ligne pourrait avoir un badge :
- üü¢ **Confirm√©** : D√©contamination confirm√©e par avis officiel
- üü° **Pr√©sum√©** : Absent du registre gouvernemental sans avis formel
- üîµ **Archiv√©** : Ancien terrain, historique complet

---

### 3. **Sources de Donn√©es**

#### Option A : Donn√©es Municipales avec Avis
```javascript
// Dans load_municipal_data.py ou via l'interface
{
  "adresse": "123, rue Exemple",
  "lot": "1234567",
  "reference": "7610-08-01-XXXXX-XX",
  "avis_decontamination": "2023-05-15",  // ‚úÖ DATE PR√âSENTE
  "bureau_publicite": "12345678",
  "commentaires": "D√©contamin√© suite √† l'avis du MELCCFP"
}
```

#### Option B : Comparaison Historique
```javascript
// Logique dans app.js
1. Charger historique des donn√©es municipales (si disponible)
2. Comparer avec le registre gouvernemental actuel
3. Identifier les terrains qui ont "disparu" du registre
4. V√©rifier s'ils ont un avis de d√©contamination
5. Les d√©placer vers l'onglet "D√©contamin√©s"
```

---

### 4. **Impl√©mentation Technique**

#### Modification de `src/app.js`

```javascript
/**
 * Identifier et cat√©goriser les terrains d√©contamin√©s
 */
function identifyDecontaminatedLands() {
    decontaminatedData = municipalData.filter(item => {
        // Crit√®re 1 : A une date d'avis de d√©contamination
        const hasDecontaminationNotice = item.avis_decontamination && 
                                        item.avis_decontamination.trim() !== '';
        
        // Crit√®re 2 : Commentaire mentionne "d√©contamin√©"
        const hasDecontaminationComment = item.commentaires && 
                                         item.commentaires.toLowerCase().includes('d√©contamin√©');
        
        // Crit√®re 3 : Avait une r√©f√©rence mais n'est plus dans le registre gouvernemental
        const hadReference = item.reference && item.reference.trim() !== '';
        const notInGovernmentRegistry = hadReference && 
                                       !governmentData.some(gov => 
                                           gov.NO_MEF_LIEU === item.reference
                                       );
        
        return hasDecontaminationNotice || 
               (notInGovernmentRegistry && hasDecontaminationComment);
    });
    
    // Trier par date de d√©contamination (plus r√©cent en premier)
    decontaminatedData.sort((a, b) => {
        const dateA = new Date(a.avis_decontamination || '1900-01-01');
        const dateB = new Date(b.avis_decontamination || '1900-01-01');
        return dateB - dateA;
    });
    
    console.log(`‚úÖ ${decontaminatedData.length} terrains d√©contamin√©s identifi√©s`);
}

/**
 * Afficher les terrains d√©contamin√©s avec informations enrichies
 */
function displayDecontaminatedData(table, data) {
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';
    
    if (data.length === 0) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 7;
        cell.className = 'text-center text-muted';
        cell.innerHTML = `
            <div class="py-4">
                <p class="mb-2">üìÇ Aucun terrain d√©contamin√© archiv√©</p>
                <small>Les terrains avec avis de d√©contamination appara√Ætront ici</small>
            </div>
        `;
        row.appendChild(cell);
        tbody.appendChild(row);
        return;
    }
    
    data.forEach((item, index) => {
        const row = document.createElement('tr');
        
        // Badge de statut
        const hasNotice = item.avis_decontamination && item.avis_decontamination !== '';
        const statusBadge = hasNotice 
            ? '<span class="badge bg-success">üü¢ Confirm√©</span>'
            : '<span class="badge bg-warning">üü° Pr√©sum√©</span>';
        
        // Formatage de la date
        const decontaminationDate = item.avis_decontamination 
            ? new Date(item.avis_decontamination).toLocaleDateString('fr-CA')
            : 'Non sp√©cifi√©e';
        
        const columns = [
            item.adresse || '',
            item.lot || '',
            item.reference || 'N/A',
            decontaminationDate,
            item.bureau_publicite || '',
            statusBadge,
            item.commentaires || ''
        ];
        
        columns.forEach((value, colIndex) => {
            const cell = document.createElement('td');
            if (colIndex === 5) {
                // Colonne statut : ins√©rer HTML
                cell.innerHTML = value;
            } else {
                cell.textContent = value;
            }
            row.appendChild(cell);
        });
        
        tbody.appendChild(row);
    });
}
```

#### Modification de `index.html`

```html
<!-- Onglet D√©contamin√©s -->
<div class="tab-pane fade" id="decontaminated" role="tabpanel">
    <div class="alert alert-success" role="alert">
        <h5>‚úÖ Archive des Terrains D√©contamin√©s</h5>
        <p class="mb-0">
            Ces terrains ont fait l'objet d'une d√©contamination et ne figurent plus 
            dans le registre actif du gouvernement. Cette archive est conserv√©e √† 
            des fins de tra√ßabilit√© et d'historique.
        </p>
        <hr>
        <p class="mb-0">
            <strong>üìä Total :</strong> <span id="decontaminated-count">0</span> terrains d√©contamin√©s
        </p>
    </div>
    
    <!-- Filtres -->
    <div class="filter-section">
        <h5>Filtres</h5>
        <div class="row">
            <div class="col-md-3">
                <input type="text" id="decontaminated-address-filter" 
                       class="form-control" placeholder="Filtrer par adresse">
            </div>
            <div class="col-md-3">
                <input type="text" id="decontaminated-year-filter" 
                       class="form-control" placeholder="Ann√©e de d√©contamination">
            </div>
            <div class="col-md-3">
                <input type="text" id="decontaminated-lot-filter" 
                       class="form-control" placeholder="Filtrer par lot">
            </div>
            <div class="col-md-3">
                <input type="text" id="decontaminated-search" 
                       class="form-control" placeholder="Recherche globale">
            </div>
        </div>
    </div>
    
    <button id="export-pdf-decontaminated" class="btn btn-primary btn-export">
        üìÑ Exporter en PDF
    </button>
    
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="decontaminated-table">
            <thead class="table-dark">
                <tr>
                    <th>Adresse</th>
                    <th>Lot</th>
                    <th>Ancienne R√©f. MENVIQ</th>
                    <th>Date D√©contamination</th>
                    <th>Bureau Publicit√©</th>
                    <th>Statut</th>
                    <th>Commentaires</th>
                </tr>
            </thead>
            <tbody id="decontaminated-tbody">
                <!-- Les donn√©es seront ins√©r√©es ici par JavaScript -->
            </tbody>
        </table>
    </div>
</div>
```

---

### 5. **Fonctionnalit√©s Avanc√©es (Optionnelles)**

#### A. Historique D√©taill√©
```javascript
// Ajouter un bouton "Voir historique" sur chaque ligne
// Au clic, afficher un modal avec :
- Timeline de la contamination √† la d√©contamination
- Documents associ√©s (si disponibles)
- Photos avant/apr√®s (si disponibles)
```

#### B. Export Sp√©cialis√©
```javascript
// Export PDF avec :
- En-t√™te sp√©cifique "Archive des Terrains D√©contamin√©s"
- Statistiques par ann√©e
- Graphique d'√©volution (si plusieurs ann√©es)
```

#### C. Recherche Avanc√©e
```javascript
// Recherche par :
- Plage de dates
- Type de contamination initiale
- M√©thode de d√©contamination
```

---

### 6. **Gestion des Donn√©es**

#### Format du Fichier CSV Municipal
```csv
adresse,lot,reference,avis_decontamination,bureau_publicite,commentaires
"123, rue Exemple","1234567","7610-08-01-12345-06","2023-05-15","12345678","D√©contamin√© suite √† avis MELCCFP"
"456, avenue Test","7654321","7610-08-01-67890-08","2022-11-20","87654321","R√©habilitation compl√©t√©e, usage r√©sidentiel autoris√©"
```

#### Validation des Donn√©es
```javascript
// S'assurer que :
1. La date d'avis est au format valide (YYYY-MM-DD)
2. Le num√©ro de bureau de publicit√© existe si la d√©contamination est confirm√©e
3. Les commentaires sont pr√©sents pour justifier l'archivage
```

---

### 7. **Interface Utilisateur - Wireframe**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úÖ Archive des Terrains D√©contamin√©s                        ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ Ces terrains ont fait l'objet d'une d√©contamination...      ‚îÇ
‚îÇ üìä Total : 12 terrains d√©contamin√©s                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Filtres:                                                     ‚îÇ
‚îÇ [Adresse...] [Ann√©e...] [Lot...] [Recherche...]            ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ [üìÑ Exporter en PDF]                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇAdr.  ‚îÇ Lot ‚îÇ Anc.R√©f. ‚îÇ   Date   ‚îÇ Bureau  ‚îÇ Statut ‚îÇ Comm.‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ123,  ‚îÇ12345‚îÇ7610-...  ‚îÇ2023-05-15‚îÇ12345678 ‚îÇüü¢ Conf.‚îÇD√©con.‚îÇ
‚îÇrue E.‚îÇ67   ‚îÇ          ‚îÇ          ‚îÇ         ‚îÇ        ‚îÇsuit..‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ456,  ‚îÇ76543‚îÇN/A       ‚îÇ2022-11-20‚îÇ87654321 ‚îÇüü¢ Conf.‚îÇR√©hab.‚îÇ
‚îÇave T.‚îÇ21   ‚îÇ          ‚îÇ          ‚îÇ         ‚îÇ        ‚îÇcompl.‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Recommandation Finale

**Je recommande l'approche suivante :**

### Phase 1 : Impl√©mentation de Base (Imm√©diate)
1. ‚úÖ D√©tection automatique bas√©e sur `avis_decontamination`
2. ‚úÖ Affichage dans un tableau avec badge de statut
3. ‚úÖ Filtres de base (adresse, lot, ann√©e)
4. ‚úÖ Export PDF

### Phase 2 : Enrichissement (Court terme)
1. üîÑ Comparaison avec historique des donn√©es
2. üîÑ Recherche avanc√©e
3. üîÑ Statistiques par ann√©e

### Phase 3 : Fonctionnalit√©s Avanc√©es (Long terme)
1. üìÖ Timeline interactive
2. üìé Pi√®ces jointes (documents, photos)
3. üìä Graphiques d'√©volution

---

## üí¨ Questions √† Consid√©rer

1. **Voulez-vous conserver un historique des anciennes versions du registre ?**
   - Si oui, il faudra stocker les anciennes donn√©es gouvernementales

2. **Les avis de d√©contamination sont-ils toujours disponibles ?**
   - Important pour la tra√ßabilit√© l√©gale

3. **Devrait-on archiver automatiquement ou manuellement ?**
   - Automatique : Bas√© sur la date d'avis
   - Manuelle : L'utilisateur confirme l'archivage

4. **Faut-il une validation avant archivage ?**
   - Workflow d'approbation ?
   - Double v√©rification ?

---

**Quelle approche pr√©f√©rez-vous ? Je peux impl√©menter la solution choisie imm√©diatement.** üöÄ
