<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Terrains Contamin√©s - Val-d'Or</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
        .filter-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .table-responsive {
            margin-bottom: 20px;
        }
        table {
            font-size: 0.9rem;
        }
        .btn-export {
            margin-bottom: 20px;
        }
        /* Styles pour le tableau gouvernemental */
        #government-table td {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }
        #government-table td:nth-child(2) {
            /* Colonne adresse - plus large */
            max-width: 250px;
        }
        #government-table td:nth-child(4) {
            /* Colonne √âtat r√©habilitation */
            max-width: 180px;
            white-space: nowrap;
        }
        #government-table td:nth-child(5),
        #government-table td:nth-child(6) {
            /* Colonnes Qualit√© avant/apr√®s */
            max-width: 100px;
            font-size: 0.8rem;
            text-align: center;
        }
        #government-table td:nth-child(7) {
            /* Colonne Contaminants - plus large */
            max-width: 300px;
            font-size: 0.85rem;
        }
        #government-table td:nth-child(1),
        #government-table td:nth-child(3),
        #government-table td:nth-child(9) {
            /* Colonnes courtes : R√©f√©rence, Code postal */
            max-width: 120px;
        }
        /* Liens vers les fiches */
        .fiche-link {
            display: inline-block;
            margin: 2px;
            padding: 2px 8px;
            background-color: #0d6efd;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
        }
        .fiche-link:hover {
            background-color: #0b5ed7;
            color: white;
        }
        /* Badge pour √©tat de r√©habilitation */
        .badge-decontamine {
            background-color: #198754;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .badge-en-cours {
            background-color: #ffc107;
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .badge-non-debutee {
            background-color: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        /* Contaminants - texte plus petit et scrollable */
        .contaminants-cell {
            max-height: 80px;
            overflow-y: auto;
            font-size: 0.8rem;
            line-height: 1.3;
        }
        .contaminants-cell::-webkit-scrollbar {
            width: 6px;
        }
        .contaminants-cell::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        /* Badge pour qualit√© des sols */
        .qual-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .qual-a { background-color: #198754; color: white; }
        .qual-b { background-color: #ffc107; color: #000; }
        .qual-c { background-color: #fd7e14; color: white; }
        .qual-bc { background-color: #ff6b6b; color: white; }
        .qual-empty { background-color: #6c757d; color: white; }
        /* Styles pour le tableau des terrains d√©contamin√©s */
        #decontaminated-table td,
        #pending-decontaminated-table td {
            vertical-align: middle;
        }
        #decontaminated-table td:nth-child(6),
        #pending-decontaminated-table td:nth-child(6) {
            /* Colonne statut - centr√© */
            text-align: center;
        }
        .badge {
            font-size: 0.85rem;
            padding: 0.4em 0.6em;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #pending-validation-section {
            animation: highlight 2s ease-in-out;
        }
        @keyframes highlight {
            0%, 100% { background-color: white; }
            50% { background-color: #fff3cd; }
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            border-radius: 10px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
            width: 50px;
            height: 50px;
            font-size: 24px;
            padding: 0;
            line-height: 50px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }
        .back-to-top:hover {
            transform: translateY(-5px);
        }
        .back-to-top.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-4">
            <img src="/assets/valdor-logo.png" alt="Logo Ville de Val-d'Or" style="max-height: 120px; margin-bottom: 20px;">
            <h1>üìä Application de Gestion des Terrains Contamin√©s</h1>
            <p class="lead">Ville de Val-d'Or - Registre des terrains contamin√©s</p>
        </div>
        <div class="text-center mb-3">
            <a href="upload-data.html" class="btn btn-primary">
                üì§ Charger vos donn√©es municipales
            </a>
        </div>
        
        <!-- Statistiques -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <h5>Terrains municipaux</h5>
                    <h2 id="stats-municipal">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h5>Registre gouvernemental</h5>
                    <h2 id="stats-government">0</h2>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <h5>D√©contamin√©s valid√©s</h5>
                    <h2 id="stats-decontaminated">0</h2>
                    <span id="stats-pending-decontaminated" class="badge bg-warning">0</span> en attente
                </div>
            </div>
        </div>
        
        <!-- Onglets -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="municipal-tab" data-bs-toggle="tab" data-bs-target="#municipal" type="button" role="tab">
                    üèòÔ∏è Donn√©es municipales
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="government-tab" data-bs-toggle="tab" data-bs-target="#government" type="button" role="tab">
                    üèõÔ∏è Registre gouvernemental
                </button>
            </li>

            <li class="nav-item" role="presentation">
                <button class="nav-link" id="decontaminated-tab" data-bs-toggle="tab" data-bs-target="#decontaminated" type="button" role="tab">
                    ‚úÖ D√©contamin√©s
                </button>
            </li>
        </ul>
        
        <!-- Contenu des onglets -->
        <div class="tab-content" id="myTabContent">
            <!-- Onglet Donn√©es municipales -->
            <div class="tab-pane fade show active" id="municipal" role="tabpanel">
                <div class="filter-section">
                    <h5>Filtres</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <input type="search" id="address-filter" class="form-control" placeholder="Filtrer par adresse" aria-label="Filtrer par adresse">
                        </div>
                        <div class="col-md-4">
                            <input type="search" id="lot-filter" class="form-control" placeholder="Filtrer par lot" aria-label="Filtrer par lot">
                        </div>
                        <div class="col-md-4">
                            <input type="search" id="reference-filter" class="form-control" placeholder="Filtrer par r√©f√©rence" aria-label="Filtrer par r√©f√©rence">
                        </div>
                    </div>
                </div>
                
                <button id="export-pdf-municipal" class="btn btn-primary btn-export">
                    üìÑ Exporter en PDF
                </button>
                
                <div class="loading" id="loading-municipal">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="municipal-table">
                        <thead class="table-dark">
                            <tr>
                                <th>Adresse</th>
                                <th>Lot</th>
                                <th>R√©f√©rence</th>
                                <th>Avis d√©contamination</th>
                                <th>Bureau publicit√©</th>
                                <th>Commentaires</th>
                            </tr>
                        </thead>
                        <tbody id="municipal-tbody">
                            <!-- Les donn√©es seront ins√©r√©es ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Onglet Registre gouvernemental -->
            <div class="tab-pane fade" id="government" role="tabpanel">
                <div class="mb-3">
                    <button id="sync-government-data" class="btn btn-info">
                        üîÑ Synchroniser les donn√©es
                    </button>
                    <small class="text-muted ms-2">Recharger les donn√©es depuis le registre gouvernemental</small>
                </div>
                <div class="filter-section">
                    <h5>Filtres</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <input type="search" id="government-address-filter" class="form-control" placeholder="Filtrer par adresse" aria-label="Filtrer par adresse">
                        </div>
                        <div class="col-md-4">
                            <input type="search" id="government-lot-filter" class="form-control" placeholder="Filtrer par lot" aria-label="Filtrer par lot">
                        </div>
                        <div class="col-md-4">
                            <input type="search" id="government-reference-filter" class="form-control" placeholder="Filtrer par r√©f√©rence" aria-label="Filtrer par r√©f√©rence">
                        </div>
                    </div>
                </div>
                
                <button id="export-pdf-government" class="btn btn-primary btn-export">
                    üìÑ Exporter en PDF
                </button>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="government-table">
                        <thead class="table-dark">
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Adresse</th>
                                <th>Code postal</th>
                                <th>√âtat r√©habilitation</th>
                                <th>Qualit√© avant</th>
                                <th>Qualit√© apr√®s</th>
                                <th>Contaminants (Sol)</th>
                                <th>Milieu r√©cepteur</th>
                            </tr>
                        </thead>
                        <tbody id="government-tbody">
                            <!-- Les donn√©es seront ins√©r√©es ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            

            
            <!-- Onglet D√©contamin√©s -->
            <div class="tab-pane fade" id="decontaminated" role="tabpanel">
                <div class="alert alert-success" role="alert">
                    <h5>‚úÖ Archive des Terrains D√©contamin√©s</h5>
                    <p class="mb-0">
                        Ces terrains ont fait l'objet d'une d√©contamination et ne figurent plus 
                        dans le registre actif du gouvernement. Cette archive est conserv√©e √† 
                        des fins de tra√ßabilit√© et d'historique.
                    </p>
                    <hr>
                    <p class="mb-0">
                        <strong>üìä Total :</strong> <span id="decontaminated-filtered-count">0</span> terrains d√©contamin√©s valid√©s
                    </p>
                </div>
                
                <!-- Bouton de diagnostic pour probl√®mes de cache -->
                <div class="mb-3">
                    <button id="force-refresh-decontaminated" class="btn btn-warning btn-sm">
                        üîÑ Forcer le rafra√Æchissement du cache
                    </button>
                    <small class="text-muted ms-2">Si vous ne voyez pas vos donn√©es, cliquez ici pour vider le cache du navigateur</small>
                </div>
                
                <!-- Section de validation des terrains en attente -->
                <div class="card mb-3" id="pending-validation-section" style="border-left: 4px solid #ffc107;">
                    <div class="card-body">
                        <h5 class="card-title">‚ö†Ô∏è Terrains en attente de validation</h5>
                        <p class="card-text">
                            Ces terrains ont √©t√© d√©tect√©s automatiquement comme potentiellement d√©contamin√©s. 
                            Veuillez valider ou rejeter chaque terrain.
                        </p>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover" id="pending-decontaminated-table">
                                <thead class="table-warning">
                                    <tr>
                                        <th>Adresse</th>
                                        <th>Lot</th>
                                        <th>R√©f. MENVIQ</th>
                                        <th>Date d√©cont.</th>
                                        <th>Bureau</th>
                                        <th>Statut</th>
                                        <th>Crit√®res</th>
                                        <th>Commentaires</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-decontaminated-tbody">
                                    <!-- Les donn√©es seront ins√©r√©es ici par JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Statistiques annuelles (Phase 2) -->
                <div id="decontamination-yearly-stats" class="mb-3">
                    <!-- Les statistiques seront ins√©r√©es ici -->
                </div>
                
                <!-- Filtres avanc√©s (Phase 2) -->
                <div class="filter-section">
                    <h5>Filtres</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <input type="search" id="decontaminated-address-filter"
                                   class="form-control" placeholder="Filtrer par adresse" aria-label="Filtrer par adresse">
                        </div>
                        <div class="col-md-3">
                            <select id="decontaminated-year-filter" class="form-select" aria-label="Filtrer par ann√©e">
                                <option value="">Toutes les ann√©es</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="decontaminated-status-filter" class="form-select" aria-label="Filtrer par statut">
                                <option value="">Tous les statuts</option>
                                <option value="high">üü¢ Confirm√©</option>
                                <option value="medium">üü° Probable</option>
                                <option value="low">‚ö™ Pr√©sum√©</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="location.reload()">
                                üîÑ R√©initialiser les filtres
                            </button>
                        </div>
                    </div>
                </div>
                
                <button id="export-pdf-decontaminated" class="btn btn-primary btn-export">
                    üìÑ Exporter en PDF
                </button>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="decontaminated-table">
                        <thead class="table-dark">
                            <tr>
                                <th>Adresse</th>
                                <th>Lot</th>
                                <th>R√©f. MENVIQ</th>
                                <th>Date d√©contamination</th>
                                <th>Bureau publicit√©</th>
                                <th>Statut</th>
                                <th>Crit√®res de d√©tection</th>
                                <th>Commentaires</th>
                            </tr>
                        </thead>
                        <tbody id="decontaminated-tbody">
                            <!-- Les donn√©es seront ins√©r√©es ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Section Rapport et Export -->
        <div class="mt-5">
            <h3>üìã G√©n√©rer un rapport</h3>
            <p>G√©n√©rez un rapport complet pour les demandes d'acc√®s √† l'information.</p>
            <button id="generate-report" class="btn btn-success me-2">
                üìÑ G√©n√©rer le rapport complet
            </button>
        </div>
    </div>
    
    <div class="footer">
        <p>¬© 2024 Ville de Val-d'Or - Application de gestion des terrains contamin√©s</p>
        <p><small>Derni√®re mise √† jour : <span id="last-update">En attente...</span></small></p>
    </div>
    
    <!-- Bouton Retour en haut -->
    <button id="back-to-top" class="btn btn-primary btn-lg rounded-circle back-to-top" aria-label="Retour en haut de la page" title="Retour en haut">
        ‚¨ÜÔ∏è
    </button>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application JS (sera charg√© comme module) -->
    <script type="module" src="/src/app.js"></script>
</body>
</html>
